<!DOCTYPE html>
<html>
<head>
    <!-- If IE use the latest rendering engine -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Set the page to the width of the device and set the zoon level -->
    <meta name="viewport" content="width = device-width, initial-scale = 1">
    <title>EduWell</title>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
            integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
            crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
          integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
          crossorigin=""/>


    <style>
        .content1 {
            position: relative;
            bottom: 0px;
            left: 0px;
            right: 0px;
            overflow: scroll;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 30px;
            /*padding-left: 10%;*/
            /*padding-right: 10%;*/
        }

        .float-left .card {
            float: left;
            /*width:31.3%;  */
        }

        .card {
            background: #FFF;
            border: 1px solid #AAA;
            /*border-bottom: 3px solid #BBB;*/
            padding: 10px;
            margin: 15px;
            padding-top: 40px;
            overflow: auto;
            height: 1040px;
        }

        .favDel {
            height: 15px;
            right: 0;
            border: none;
            background: none;
            color: grey;
            position: absolute;
            width: auto;
        }

        .chart div {
            font: 10px sans-serif;
            background-color: steelblue;
            text-align: right;
            padding: 3px;
            margin: 1px;
            color: white;
        }

        /*button {*/
            /*border: none;*/
            /*outline: 0;*/
            /*display: inline-block;*/
            /*padding: 8px;*/
            /*color: white;*/
            /*background-color: #000;*/
            /*text-align: center;*/
            /*cursor: pointer;*/
            /*width: 80%;*/
            /*font-size: 18px;*/
            /*vertical-align: bottom;*/
            /*!*position: absolute;*!*/
            /*bottom: 20px;*/
            /*left: 10%;*/
        /*}*/

        input[type=checkbox].glyphicon {
            visibility: hidden;
        }
        h4{

        }
        .extrapad{
            padding-left: 5%;
            padding-right: 5%;
        }
        #content {
            margin: 10px 10px 10px 10px;
             padding-left: 0px !important;
             padding-right: 0px !important;
            width: -webkit-fill-available;
        }
    </style>
</head>

<body onload="load()">

<section id="all">
    <section class="header">
        <div id="logo">
            <button id="homelogo" onclick="location.href='index.html'"></button>
        </div>
        <div style="display: inline-block;float: right; font-family: Roboto, Helvetica, Arial, sans-serif;">
            <div id="main-navigation" class="collapse navbar-collapse"><ul id="menu-homepage" class="nav navbar-nav navbar-right"><li id="menu-item-223" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-223"><a class="menu_link" title="Home" href="index.html">Home</a></li>
                <li id="menu-item-221" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-221"><a class="menu_link" title="Explore" href="index.html#about">About</a></li>
                <li id="menu-item-40" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-40"><a class="menu_link" title="Data Sources" href="data_sources.html">Data Sources</a></li>

            </ul></div>			<button type="button" class="navbar-toggle glyphicon glyphicon-menu-hamburger" data-toggle="collapse" data-target="#main-navigation"></button>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="sr-only">Toggle Navigation</span>
        </div>

        </button>


    </section>



<section id="content" class="container">
    <div class="row">
        <div class="col-lg-2 col-md-2 col-sm-4 col-xs-6">
            <button class="eduwellButton" onclick="window.location.href = 'maptest.html'">< Back to Map</button>
        </div>
<div class="col-lg-2 col-md-2 col-sm-4 col-xs-6" style="float:right">
            <button class="eduwellButton" onclick="printFunction()">Print The Result ></button>
        </div>
    </div>
    <div class="row">
        <div class="content1 float-left" id="data"></div>
    </div>
</section>

<section class="footer header">
    <div style="padding-left: 20px" class="smalltext">
        <div class="attribution">
            <a href="https://developers.google.com/places/" target="_blank"><img src="https://vignette1.wikia.nocookie.net/ichc-channel/images/7/70/Powered_by_google.png/revision/latest?cb=20160331203712">
            </a>
        </div>
        <div class="attribution">
            <a href="https://icons8.com/" target="_blank">
                <img src="https://maxcdn.icons8.com/Share/icon/color/Logos//icons8_logo1600.png" height="40" style="display: inline-block;">
                icons from icons8
            </a>
        </div>
        <div class="disclaimer">
            This website was created for educational purposes. All data contained within has been included in accordance with open licenses. Any violation of copyright has occured without knowlege and will warrant the immediate removal of infringing material on notification.

        </div>
    </div>

</section>


    <!--<script type="text/javascript" src="data/schoolList.json" async></script>-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqwXeBF0eH49temHUaJR49atlSoTgBPzo&libraries=places"
            async defer type="text/javascript"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

function printFunction() {
    window.print();
}

        function load() {

//            require()

            let element = document.getElementById('data');
            $.getJSON("data/schoolList.json", function (json) {
                var mydata = json
                $.get('connecttest.php', function(json) {
                    console.log( "adbg;asbd");
                    mydata = JSON.parse(json)
                }).fail(function( jqxhr, textStatus, error ) {
                    //On failure read from local file
                    var err = textStatus + ", " + error;
                    console.log( "Request Failed: " + err );
                    console.log('Loading data from local JSON')
                    $.getJSON("data/schoolList.json", function(json) {
                        mydata = json
                    })
                });
                let datalength = localStorage[100]
                console.log(datalength)
                var passdata = [];
                for (i = 0; i < datalength; i++) {
                    passdata[i] = localStorage[i]
                }
                let colsizes = "";
                if(datalength < 3){
                    colsizes = "col-lg-6 col-md-6 col-sm-12 col-xs-12 extrapad"
                }
                else{
                    colsizes = "col-lg-4 col-md-6 col-sm-12 col-xs-12"
                }

                //Get Website


                //service = new google.maps.places.PlacesService(document.getElementById('map'))




                mydata.map((data) => {
                    x = 1;
                    let website = ""
                    for (i in passdata) {
                        if (passdata[i] == data.School_Id) {


//                            Get Website and other ma data FLANNERY USE THIS
                            let Address = data.Address1
                                + data.Address2 + ", " +
                                data.Town + " " + data.PPostcode

                            let request = {
                                location: {lat: data.Latitude, lng:data.Longitude},
                                radius: '500',
                                keyword: [(data.School_Name + "," + Address)]
                            }

                            try {
                                service = new google.maps.places.PlacesService(document.getElementById('map'))
                                service.nearbySearch(request, (results) => {
                                    if(results.length > 0){
                                        placeId = results[0].place_id

                                        service.getDetails({
                                            placeId: placeId
                                        }, (details) => {
                                            if(details != undefined && details != null){
                                                website = details.website
                                                console.log(website)
                                            }
                                            if (website == undefined || website == null) {
                                                website = "N/A"
                                            }
                                            addDetails()
                                        })
                                    }
                                    else{
                                        website = data["New.web"]
                                        if(website == undefined || website == null || website == "")
                                        {
                                            website = "N/A"
                                        }
                                        addDetails()
                                    }

                                })
                            }
                            catch (err){
                                console.log('error')
                                console.log(err)
                                website = data["New.web"]
                                if(website == undefined || website == null || website == "")
                                {
                                website = "N/A"
                                }
                                addDetails()
                            }




                            function addDetails (){
                                let Address = data.Address1 + data.Address2 + ", " + data.Town + " " + data.PPostcode;
                                let streetView_imgURL = encodeURI(("https://maps.googleapis.com/maps/api/streetview?size=600x300&location=" + data.School_Name.replace("'","") + "," + Address + "&key=AIzaSyDL8mL_M5dy0iux97ExLt8gRrj_NNtbmII"));
                                var widthBoy = parseFloat(Math.round(data.Male/(data.Male+data.Female) * 100) ).toFixed(2) + "%";
                                var widthGirl = parseFloat(Math.round(data.Female/(data.Male+data.Female) * 100) ).toFixed(2) + "%";

                                //Class size
                                let classSize = "Not Available"
                                if(data.AverageClassSize !== undefined && data.AverageClassSize !== null){
                                    classSize = parseInt(data.AverageClassSize) + " students"
                                }

                                //Calculate distance
                                area = L.latLng(localStorage[98],localStorage[97])
                                areaName = localStorage[96]
                                schoolLoc = L.latLng(data.Latitude, data.Longitude)
                                distance = area.distanceTo(schoolLoc)
                                console.log(distance)



                                element.innerHTML += "<div class='" + colsizes + "'>" +
                                    "<div class='col-lg-12 col-md-12 col-sm-12 col-xs-12 card sidebar' id=" + x + "> " +
                                    "<button class='favDel glyphicon glyphicon-remove' type='checkbox' id=" + x +
                                    "></button>" +
                                    "<h4 style='text-align:center; height:50px; font-size:18pt !important; color:black; font-weight:bold;'>" + data.School_Name + "</h4>" +
                                    "<img style='height:21%; width:100%;' id='streetview_Img' class='nohover' src='" + streetView_imgURL + "'>" +
                                    "<br><br><b>Sector:</b> " + data.Sector + "<br><br>" +
                                    "<b>Distance: </b>" + (distance/1000).toFixed(2) + "km from " + areaName + "<br><br>" +
                                    "<b>Students enrolled: </b>" + getStudentsIcon(data) + "<br>" +
                                    "<b>Average Class Size: </b>" + classSize + "<br><br>" +
                                    "<h4>Gender Balance:</h4>" +
                                    "<img src='http://35.189.25.144/EduWell/icons/icons8-Boy-48.png' height='30'>" +
                                    "<b>Male: </b>" + parseInt(data.Male) + "  <div class='chart'><div style='width:" + widthBoy + "'>" + widthBoy + "</div></div><br>" +
                                    "<img src='http://35.189.25.144/EduWell/icons/icons8-Girl-64.png' height='30'>" +
                                    "<b>Female: </b>" + parseInt(data.Female) + "  <div class='chart'><div style='width:" + widthGirl + "'>" + widthGirl + "</div></div><br>" +
                                    "<b>Buildings: </b>" + getBuildingsIcon(data) + "<br>" +
                                    "<b>Total building area: </b>" + getFloorAreaIcon(data) + "<br>" +
                                    "<b>Average Annual Investment <img style='height:18px' src='http://35.189.25.144/EduWell/icons/icons8-About-26.png' title='Investments for capital and  maintenance works, &#013;parent contributions received in advance for &#013;curriculum and camps, school specific programs&#013;and on behalf of the school community.' /> : </b> " + getInvestIcon(data) + "<br>" +
                                    "<h4>Special Programs:</h4>" +
                                    "<img src='http://35.189.25.144/EduWell/icons/icons8-LGBT Flag-48.png' height='30'>" +
                                    "<b>Safe Schools (LGBT Support):</b> " + isLGBT(data) + "<br>" +
                                    "<img src='http://35.189.25.144/EduWell/icons/icons8-Exercise-48.png' height='30'>" +
                                    "<b>ASPE Support:</b> " + isASPE(data) + "<br>" +
                                    "<p style='text-align:center; font-style:italic'>" + Address + '<br>' + data.Phone + "<br><br>" +

                                    "<b><a href='" + website + "' target='_blank'><button class='infobutton eduwellButton'>Visit The School Website</button></a>"
                                $(".favDel").on('click', function (del) {
                                    let id = del.target.id
                                    let cards = $(".card")
                                    console.log(cards)
                                    console.log(id)
                                    for (i = 0; i < cards.length; i++) {
                                        if (cards[i].id == id) {
                                            console.log(id)
                                            cards[i].parentElement.parentElement.removeChild(cards[i].parentElement)
                                            console.log(passdata)
                                            passdata = passdata.filter((x) => {
                                                console.log(x)
                                                console.log(data.School_Id)
                                                return x != data.School_Id
                                            })
                                            console.log(passdata)
                                            localStorage[60] = passdata
                                        }
                                    }
                                })

                                x = x + 1
                            }

                        }
                    }
                })
            })

            let isLGBT = (props) => {
                if (props.LGBT == "Y") {
                    return "<img src='http://35.189.25.144/EduWell/icons/icons8-Tick-26.png' height='19'> Yes <br>";
                }
                else {
                    return "<img src='http://35.189.25.144/EduWell/icons/icons8-Multiply-26.png' height='19'> No <br>";
                }
            }


            function getStudentsIcon(props) {
                let StudentIcon = "<img src='http://35.189.25.144/EduWell/icons/icons8-Students-48.png' height='19'>";
                if (props.Total > 1) {
                    if (parseInt(props.Total) > 0 & parseInt(props.Total) < 615) {
                        return StudentIcon + "    (" + parseInt(props.Total) + " Students)" +
                            "<br>";
                    }
                    else if (parseInt(props.Total) >= 615 & parseInt(props.Total) < 1230) {
                        return StudentIcon + StudentIcon + "    (" + parseInt(props.Total) + " Students)" +
                            "<br>";
                    }
                    else if (parseInt(props.Total) >= 1230 & parseInt(props.Total) < 1845) {
                        return StudentIcon + StudentIcon + StudentIcon + "    (" + parseInt(props.Total) + " Students)" +
                            "<br>";
                    }
                    else if (parseInt(props.Total) >= 1845 & parseInt(props.Total) < 2460) {
                        return StudentIcon + StudentIcon + StudentIcon + StudentIcon + "    (" + parseInt(props.Total) + " Students)" +
                            "<br>";
                    }
                    else {
                        return StudentIcon + StudentIcon + StudentIcon + StudentIcon + StudentIcon + "    (" + parseInt(props.Total) + " Students)" +
                            "<br>";
                    }
                }
                else {
                    return "Not Available <br>"
                }
            }

            function getBuildingsIcon(props) {
                let BuildingsIcon = "<img src='http://35.189.25.144/EduWell/icons/icons8-Building-48.png' height='19'>";
                if (props.BuildingNumber > 1) {
                    if (parseInt(props.BuildingNumber) > 0 & parseInt(props.BuildingNumber) < 17) {
                        return BuildingsIcon + "    (" + parseInt(props.BuildingNumber) + " Buildings)" +
                            "<br>";
                    }
                    else if (parseInt(props.BuildingNumber) >= 17 & parseInt(props.BuildingNumber) < 34) {
                        return BuildingsIcon + BuildingsIcon + "    (" + parseInt(props.BuildingNumber) + " Buildings)" +
                            "<br>";
                    }
                    else if (parseInt(props.BuildingNumber) >= 34 & parseInt(props.BuildingNumber) < 51) {
                        return BuildingsIcon + BuildingsIcon + BuildingsIcon + "    (" + parseInt(props.BuildingNumber) + " Buildings)" +
                            "<br>";
                    }
                    else if (parseInt(props.BuildingNumber) >= 51 & parseInt(props.BuildingNumber) < 68) {
                        return BuildingsIcon + BuildingsIcon + BuildingsIcon + BuildingsIcon + "    (" + parseInt(props.BuildingNumber) + " Buildings)" +
                            "<br>";
                    }
                    else {
                        return BuildingsIcon + BuildingsIcon + BuildingsIcon + BuildingsIcon + BuildingsIcon + "    (" + parseInt(props.BuildingNumber) + " Buildings)" +
                            "<br>";
                    }
                }
                else {
                    return "Not Available <br>"
                }
            }

            function getFloorAreaIcon(props) {
                let FloorAreaIcon = "<img src='http://35.189.25.144/EduWell/icons/icons8-Swingset-50.png' height='19'>";
                if (props.FloorArea > 1) {
                    if (parseInt(props.FloorArea) > 0 & parseInt(props.FloorArea) < 5156) {
                        return FloorAreaIcon + "    (" + parseInt(props.FloorArea) + " Square Metres)" +
                            "<br>";
                    }
                    else if (parseInt(props.FloorArea) >= 5156 & parseInt(props.FloorArea) < 10312) {
                        return FloorAreaIcon + FloorAreaIcon + "    (" + parseInt(props.FloorArea) + " Square Metres)" +
                            "<br>";
                    }
                    else if (parseInt(props.FloorArea) >= 10312 & parseInt(props.FloorArea) < 15486) {
                        return FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + "    (" + parseInt(props.FloorArea) + " Square Metres)" +
                            "<br>";
                    }
                    else if (parseInt(props.FloorArea) >= 15486 & parseInt(props.FloorArea) < 20624) {
                        return FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + "    (" + parseInt(props.FloorArea) + " Square Metres)" +
                            "<br>";
                    }
                    else {
                        return FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + FloorAreaIcon + "    (" + parseInt(props.FloorArea) + " Square Metres)" +
                            "<br>";
                    }
                }
                else {
                    return "Not Available <br>"
                }
            }

            function getInvestIcon(props) {
                let InvestIcon = "<img src='http://35.189.25.144/EduWell/icons/icons8-AustralianDollar-64.png' height='19'>";
                if (parseInt(props.Investment) > 1) {
                    if (parseInt(props.Investment) > 0 & parseInt(props.Investment) < 2030218) {
                        return InvestIcon + "    ($" + props.Investment + ")" +
                            "<br>";
                    }
                    else if (props.Investment >= 2030218 & props.Investment < 4060436) {
                        return InvestIcon + InvestIcon + "    ($" + props.Investment + ")" +
                            "<br>";
                    }
                    else if (props.Investment >= 4060436 & props.Investment < 6090654) {
                        return InvestIcon + InvestIcon + InvestIcon + "    ($" + props.Investment + ")" +
                            "<br>";
                    }
                    else if (props.Investment >= 6090654 & props.Investment < 8120872) {
                        return InvestIcon + InvestIcon + InvestIcon + InvestIcon + "    ($" + props.Investment + ")" +
                            "<br>";
                    }
                    else {
                        return InvestIcon + InvestIcon + InvestIcon + InvestIcon + InvestIcon + "    ($" + props.Investment + ")" +
                            "<br>";
                    }
                }
                else {
                    return "Not Available <br>"
                }
            }

            function isASPE(props) {
                if (props.AS_Phys == "Y") {
                    return "<img src='http://35.189.25.144/EduWell/icons/icons8-Tick-26.png' height='19'> Yes <br>";
                } else {
                    return "<img src='http://35.189.25.144/EduWell/icons/icons8-Multiply-26.png' height='19'> No <br>";
                }

            }

//

}

	
    </script>
</section>

<div id="map" hidden></div>

</body>
</html>
